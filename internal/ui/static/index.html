<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mcpenetes Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        .container { max-width: 1200px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .card { padding: 1rem; border: 1px solid var(--muted-border-color); border-radius: var(--border-radius); }
        .success { color: var(--ins-color); }
        .error { color: var(--del-color); }
        .warning { color: var(--pico-color-amber-500); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal { display: none; }
        .modal[open] { display: block; }
    </style>
</head>
<body>
    <main class="container">
        <nav>
            <ul>
                <li><strong>üßô‚Äç‚ôÇÔ∏è mcpenetes</strong> <small id="versionDisplay"></small></li>
            </ul>
            <ul>
                <li><a href="#" onclick="switchTab('dashboard')">Dashboard</a></li>
                <li><a href="#" onclick="switchTab('search')">Search & Install</a></li>
                <li><a href="#" onclick="switchTab('registries')">Registries</a></li>
                <li><a href="#" onclick="switchTab('clients')">Clients</a></li>
                <li><a href="#" onclick="switchTab('backups')">Backups</a></li>
                <li><a href="#" onclick="switchTab('logs')">Logs</a></li>
                <li><a href="#" onclick="switchTab('system')">System</a></li>
                <li><a href="#" onclick="switchTab('settings')">Settings</a></li>
                <li><a href="#" onclick="switchTab('sync')">Cloud Sync</a></li>
                <li><a href="#" onclick="switchTab('help')">Help</a></li>
                <li><a href="#" onclick="openImportModal()">Import</a></li>
                <li><a href="#" onclick="loadData(); checkDoctor();">Refresh</a></li>
            </ul>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="grid">
                <!-- Detected Clients -->
                <section>
                    <h3>Detected Clients</h3>
                    <div class="card">
                        <form id="clientsForm">
                            <div id="clientsList">Loading...</div>
                        </form>
                    </div>
                </section>

                <!-- Configured MCP Servers -->
                <section>
                    <h3>Configured MCP Servers</h3>
                    <div class="card">
                        <div id="serversList">Loading...</div>
                    </div>
                </section>
            </div>

            <hr>

            <!-- Actions -->
            <section>
                <h3>Actions</h3>
                <button onclick="applyConfig()" id="applyBtn">Apply Configuration to Selected Clients</button>
                <div id="resultArea"></div>
            </section>
        </div>

        <!-- Search Tab -->
        <div id="search" class="tab-content">
            <section>
                <h3>Search MCP Registry</h3>
                <div class="grid">
                    <div>
                        <input type="search" id="searchInput" placeholder="Search for MCP servers..." onkeyup="if(event.key === 'Enter') searchServers()">
                    </div>
                    <div>
                        <button onclick="searchServers()" id="searchBtn">Search</button>
                    </div>
                </div>
                <div id="searchResults" class="card"></div>
            </section>
        </div>

        <!-- Registries Tab -->
        <div id="registries" class="tab-content">
            <section>
                <h3>Configured Registries</h3>
                <div class="card">
                    <div id="registriesList">Loading...</div>
                </div>
                <hr>
                <h4>Add Registry</h4>
                <div class="grid">
                    <div><input type="text" id="newRegName" placeholder="Name (e.g. My Registry)"></div>
                    <div><input type="url" id="newRegUrl" placeholder="URL (e.g. https://...)"></div>
                    <div><button onclick="addRegistry()">Add</button></div>
                </div>
            </section>
        </div>

        <!-- Clients Tab -->
        <div id="clients" class="tab-content">
            <section>
                <h3>Known Clients</h3>
                <p>These clients are supported out-of-the-box. If one is not detected, you can configure it manually below.</p>
                <div class="card">
                    <div id="knownClientsList">Loading...</div>
                </div>
            </section>
            <hr>
            <section>
                <h3>Custom Clients</h3>
                <div class="card">
                    <div id="customClientsList">Loading...</div>
                </div>
                <hr>
                <h4>Add / Configure Client</h4>
                <div class="grid">
                    <div>
                        <label>ID</label>
                        <input type="text" id="newClientID" placeholder="e.g. my-tool">
                    </div>
                    <div>
                        <label>Name</label>
                        <input type="text" id="newClientName" placeholder="e.g. My Tool">
                    </div>
                </div>
                <div class="grid">
                    <div>
                        <label>Config Format</label>
                        <select id="newClientFormat">
                            <option value="simple-json">Simple JSON (mcpServers)</option>
                            <option value="vscode">VS Code (mcp.servers)</option>
                            <option value="claude-desktop">Claude Desktop</option>
                            <option value="yaml">YAML</option>
                            <option value="toml">TOML</option>
                        </select>
                    </div>
                    <div>
                        <label>Config Key (Optional)</label>
                        <input type="text" id="newClientConfigKey" placeholder="e.g. openctx.providers">
                        <small>Override the default JSON key (e.g. for VS Code extensions).</small>
                    </div>
                    <div>
                        <label>Base Directory</label>
                        <select id="newClientBase">
                            <option value="home">Home Directory (~/)</option>
                            <option value="appdata">AppData / .config</option>
                            <option value="userprofile">UserProfile</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label>Relative Path</label>
                    <input type="text" id="newClientPath" placeholder="e.g. .config/tool/config.json">
                </div>
                <button onclick="addCustomClient()">Add Client</button>
            </section>
        </div>

        <!-- Backups Tab -->
        <div id="backups" class="tab-content">
            <section>
                <h3>Configuration Backups</h3>
                <p>Restore previous configurations if something goes wrong.</p>
                <div class="card">
                    <div id="backupsList">Loading...</div>
                </div>
            </section>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <section>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Application Logs</h3>
                    <div>
                        <input type="text" id="logFilter" placeholder="Filter logs..." onkeyup="filterLogs()" style="display: inline-block; width: auto; margin-right: 0.5rem;" title="Type to filter log messages">
                        <button onclick="clearLogs()" class="outline error" title="Clear all application logs">Clear Logs</button>
                    </div>
                </div>

                <div class="card" style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; height: 500px; overflow-y: auto; font-family: monospace; white-space: pre-wrap;" id="logsContainer">
                    Loading logs...
                </div>
                <button onclick="loadLogs()" class="secondary outline" style="margin-top: 1rem;">Refresh Logs</button>
            </section>
        </div>

        <!-- Help Tab -->

        <!-- System Tab -->

        <div id="system" class="tab-content">
            <section>
                <h3>System Health (Doctor)</h3>
                <div class="card" id="systemDoctorReport">
                    Checking health...
                </div>
            </section>

            <section>
                <h3>System Information</h3>
                <div class="grid">
                    <div class="card">
                        <header>Build Info</header>
                        <ul>
                            <li><strong>App Version:</strong> <span id="sysAppVersion">Loading...</span></li>
                            <li><strong>Go Version:</strong> <span id="sysGoVersion">Loading...</span></li>
                            <li><strong>OS/Arch:</strong> <span id="sysOS">Loading...</span></li>
                        </ul>
                    </div>
                    <div class="card">
                         <header>Submodules</header>
                         <div id="sysSubmodules">None detected.</div>
                    </div>
                </div>
                <hr>
                <h4>Project Structure</h4>
                <div class="card">
                    <pre id="sysStructure" style="background:none; border:none; padding:0; margin:0;">Loading...</pre>
                </div>
            </section>
        </div>

        <div id="sync" class="tab-content">
            <section>
                <h3>Cloud Synchronization (GitHub Gist)</h3>
                <p>Sync your configuration across multiple machines using a private GitHub Gist.</p>

                <div id="syncUnlinked" style="display:none;">
                    <div class="card">
                        <h4>Connect to GitHub</h4>
                        <label for="githubToken">GitHub Personal Access Token (PAT)</label>
                        <input type="password" id="githubToken" placeholder="ghp_...">
                        <small>Token needs <code>gist</code> scope.</small>
                        <button onclick="setupSync()">Link GitHub Account</button>
                    </div>
                </div>

                <div id="syncLinked" style="display:none;">
                    <div class="grid">
                        <div class="card">
                            <h4>Status</h4>
                            <ul>
                                <li><strong>Status:</strong> <span class="success">‚úÖ Linked</span></li>
                                <li><strong>Gist ID:</strong> <span id="syncGistID">Loading...</span></li>
                                <li><strong>Last Synced:</strong> <span id="syncLastTime">Never</span></li>
                            </ul>
                        </div>
                        <div class="card">
                            <h4>Actions</h4>
                            <div class="grid">
                                <button onclick="syncPush()" class="outline">‚òÅÔ∏è Push to Cloud</button>
                                <button onclick="syncPull()" class="outline">üì• Pull from Cloud</button>
                            </div>
                            <small>Push uploads your local config. Pull overwrites local config (after backup).</small>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div id="settings" class="tab-content">
            <section>
                <h3>Global Settings</h3>
                <div class="card">
                    <div class="grid">
                        <div>
                            <label for="settingBackupPath">Backup Storage Path</label>
                            <input type="text" id="settingBackupPath" placeholder="~/.config/mcpetes/backups">
                            <small>Directory where configuration backups are stored.</small>
                        </div>
                        <div>
                            <label for="settingBackupRetention">Retention Policy (Max Backups)</label>
                            <input type="number" id="settingBackupRetention" placeholder="5" min="1">
                            <small>Number of backups to keep per client. Older backups are deleted automatically.</small>
                        </div>
                    </div>
                    <hr>
                    <h4>Global Environment Variables</h4>
                    <p>These variables will be injected into every server configuration unless overridden by server-specific settings.</p>
                    <div id="globalEnvContainer">
                        <div class="grid" style="margin-bottom: 0.5rem;">
                            <input type="text" placeholder="Key (e.g. OPENAI_API_KEY)" class="env-key">
                            <input type="text" placeholder="Value" class="env-value">
                        </div>
                    </div>
                    <button class="secondary outline small" onclick="addGlobalEnvField()">+ Add Variable</button>
                    <hr>
                    <button onclick="saveSettings()">Save Settings</button>
                </div>
            </section>
        </div>

        <div id="help" class="tab-content">
            <section>
                <h3>Help & Documentation</h3>
                <p>For detailed instructions, please refer to the <a href="https://github.com/tuannvm/mcpenetes/blob/main/docs/MANUAL.md" target="_blank">Full User Manual</a>.</p>
                <article>
                    <h4>üöÄ Getting Started</h4>
                    <p><strong>mcpenetes</strong> is your central hub for managing Model Context Protocol (MCP) servers across all your development tools.</p>
                    <ul>
                        <li><strong>Dashboard:</strong> The command center. View detected clients, configured servers, and apply your MCP setup.</li>
                        <li><strong>Search:</strong> Discover and install new MCP servers from configured registries.</li>
                        <li><strong>Clients:</strong> Define custom tools if they aren't automatically detected.</li>
                    </ul>

                    <h4>üõ†Ô∏è Managing Custom Clients</h4>
                    <p>Use the <strong>Clients</strong> tab to add support for any tool that reads a configuration file.</p>
                    <p>You'll need:</p>
                    <ul>
                        <li><strong>Config Format:</strong> Select the format the tool expects (e.g., Simple JSON <code>mcpServers</code> or VS Code style).</li>
                        <li><strong>Path:</strong> The relative path to the configuration file (e.g., <code>.config/mytool/config.json</code>).</li>
                    </ul>

                    <h4>üîç Inspecting & Debugging</h4>
                    <p><strong>Inspect Config:</strong> Click the <strong>üëÅÔ∏è</strong> icon next to a client in the Dashboard to see exactly what is being written to its config file.</p>
                    <p><strong>Inspect Server:</strong> Click <strong>üîç Inspect</strong> on a server to get the command for running the MCP Inspector on it.</p>
                    <p><strong>Logs:</strong> Use the <strong>Logs</strong> tab to view real-time application logs. You can filter by keyword or clear them if they get too noisy.</p>

                    <h4>üì¶ Registries</h4>
                    <p>Manage your sources for MCP servers in the <strong>Registries</strong> tab. You can add new URLs, edit existing ones, or remove them.</p>

                    <h4>üíæ Backups & Restoration</h4>
                    <p>Safety first! Every time you apply a configuration, a backup is created automatically.</p>
                    <ul>
                        <li><strong>Restore:</strong> Go to the <strong>Backups</strong> tab and click "Restore" on any entry to revert to that state.</li>
                        <li><strong>Cleanup:</strong> Click "Delete" to remove old backups and free up space.</li>
                    </ul>

                    <h4>üè• System Health</h4>
                    <p>Check the <strong>System</strong> tab to run the "Doctor" diagnostic tool. It checks for:</p>
                    <ul>
                        <li>Configuration file integrity</li>
                        <li>Required system dependencies (Node, Python, etc.)</li>
                        <li>Write permissions for client configuration paths</li>
                    </ul>
                </article>
            </section>
        </div>
    </main>

    <!-- Edit/Install Server Modal -->
    <dialog id="editModal">
        <article>
            <header>
                <a href="#close" aria-label="Close" class="close" onclick="closeEditModal()"></a>
                <span id="modalTitle">Edit Server Configuration</span>
            </header>
            <form id="editForm">
                <input type="hidden" id="editServerID">
                <input type="hidden" id="editMode" value="edit"> <!-- 'edit' or 'install' -->

                <div id="envFieldsContainer"></div>

                <label for="editConfigJSON">Configuration (JSON)</label>
                <textarea id="editConfigJSON" rows="10" style="font-family: monospace;"></textarea>
                <small>For installation, customize the command and arguments below. Commonly <code>npx -y package-name</code> or <code>uvx package-name</code>.</small>
            </form>
            <footer>
                <a href="#" role="button" class="secondary" onclick="closeEditModal()">Cancel</a>
                <a href="#" role="button" onclick="saveServerConfig()">Save / Install</a>
            </footer>
        </article>
    </dialog>

    <script>
        var configData = null;
        var searchResultsData = [];

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        async function loadData() {
            try {
                const res = await fetch('/api/data');
                configData = await res.json();

                if (configData.version) {
                    document.getElementById('versionDisplay').innerText = `v${configData.version}`;
                }

                renderClients();
                renderServers();
                renderRegistries();
            } catch (e) {
                console.error(e);
                document.getElementById('clientsList').innerHTML = `<span class="error">Error loading data: ${e}</span>`;
            }
        }


        function renderServers() {
            const list = document.getElementById('serversList');
            if (!configData.mcpServers || Object.keys(configData.mcpServers).length === 0) {
                list.innerHTML = "No servers configured.";
                return;
            }

            let html = '<ul>';
            for (const [name, server] of Object.entries(configData.mcpServers)) {
                let details = server.url ? `URL: ${server.url}` : `Command: ${server.command} ${server.args ? server.args.join(' ') : ''}`;
                html += `
                    <li style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1; margin-right: 1rem;">
                                <strong>${name}</strong>: ${details}
                            </div>
                            <div style="flex-shrink: 0;">
                                <button class="outline small" style="width: auto; padding: 0.25rem 0.5rem; margin-right: 0.5rem;" onclick="testServer('${name}')" id="test-btn-${name}" title="Test connection to server">‚ö° Test</button>
                                <button class="outline small" style="width: auto; padding: 0.25rem 0.5rem; margin-right: 0.5rem;" onclick="inspectServer('${name}')" title="View the command to run this server manually">üîç Inspect</button>
                                <button class="outline small" style="width: auto; padding: 0.25rem 0.5rem; margin-right: 0.5rem;" onclick="openEditModal('${name}')" title="Edit server configuration (JSON)">Edit</button>
                                <button class="outline small error" style="width: auto; padding: 0.25rem 0.5rem; color: var(--del-color); border-color: var(--del-color);" onclick="deleteServer('${name}')" title="Remove this server from configuration">Delete</button>
                            </div>
                        </div>
                    </li>`;
            }
            html += '</ul>';
            list.innerHTML = html;
        }

        function renderRegistries() {
            const list = document.getElementById('registriesList');
            if (!configData.registries || configData.registries.length === 0) {
                list.innerHTML = "No registries configured.";
                return;
            }

            let html = '<ul>';
            configData.registries.forEach(reg => {
                html += `
                    <li style="margin-bottom: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div><strong>${reg.name}</strong>: ${reg.url}</div>

                            <button class="outline small" style="width: auto; padding: 0.25rem 0.5rem; margin-right: 0.5rem;" onclick="openEditRegistryModal('${reg.name}', '${reg.url}')" title="Edit registry URL">Edit</button>
                            <button class="outline small error" style="width: auto; padding: 0.25rem 0.5rem; color: var(--del-color); border-color: var(--del-color);" onclick="removeRegistry('${reg.name}')" title="Remove this registry source">Remove</button>

                        </div>
                    </li>`;
            });
            html += '</ul>';
            list.innerHTML = html;
        }

        async function addRegistry() {
            const name = document.getElementById('newRegName').value;
            const url = document.getElementById('newRegUrl').value;

            if (!name || !url) {
                alert("Name and URL are required");
                return;
            }

            try {
                const res = await fetch('/api/registry/add', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name, url})
                });

                if (res.ok) {
                    document.getElementById('newRegName').value = '';
                    document.getElementById('newRegUrl').value = '';

                } else {
                    const err = await res.text();
                    alert("Failed to add registry: " + err);
                }
            } catch (e) {
                alert("Error: " + e);
            }
        }


        function openEditRegistryModal(name, url) {
            document.getElementById('editRegName').value = name;
            document.getElementById('editRegUrl').value = url;
            document.getElementById('editRegistryModal').setAttribute('open', 'true');
        }

        function closeEditRegistryModal() {
            document.getElementById('editRegistryModal').removeAttribute('open');
        }

        async function saveRegistryUpdate() {
            const name = document.getElementById('editRegName').value;
            const url = document.getElementById('editRegUrl').value;

            try {
                const res = await fetch('/api/registry/update', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name, url})
                });
                if (res.ok) {
                    closeEditRegistryModal();
                    loadData();
                    showToast("Registry updated", 'success');
                } else {
                    showToast("Failed: " + await res.text(), 'error');
                }
            } catch (e) { showToast("Error: " + e, 'error'); }
        }

        async function removeRegistry(name) {
            if (!confirm(`Remove registry '${name}'?`)) return;

            try {
                const res = await fetch('/api/registry/remove', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name})
                });

                if (res.ok) {

                } else {
                    const err = await res.text();
                    alert("Failed to remove registry: " + err);
                }
            } catch (e) {
                alert("Error: " + e);
            }
        }

        function openEditModal(serverID) {
            const server = configData.mcpServers[serverID];
            if (!server) return;

            document.getElementById('editServerID').value = serverID;
            document.getElementById('editMode').value = 'edit';
            document.getElementById('modalTitle').innerText = `Edit ${serverID}`;

            // Clear env fields if any
            document.getElementById('envFieldsContainer').innerHTML = '';

            // Pretty print JSON for editing
            document.getElementById('editConfigJSON').value = JSON.stringify(server, null, 2);
            document.getElementById('editModal').setAttribute('open', 'true');
        }

        function openInstallModal(serverID) {
            document.getElementById('editServerID').value = serverID;
            document.getElementById('editMode').value = 'install';
            document.getElementById('modalTitle').innerText = `Install ${serverID}`;

            // Clear previous env fields
            const envContainer = document.getElementById('envFieldsContainer');
            envContainer.innerHTML = '';

            // Check for schema
            const server = searchResultsData.find(s => s.Name === serverID);
            console.log("Install Modal Server:", server);
            if (server && server.EnvSchema && server.EnvSchema.properties) {
                let html = '<h5 style="margin-bottom:0.5rem">Environment Variables</h5><div class="grid" style="grid-template-columns: 1fr; gap:0.5rem;">';
                const props = server.EnvSchema.properties;
                const required = server.EnvSchema.required || [];

                for (const [key, prop] of Object.entries(props)) {
                    const isRequired = required.includes(key);
                    const label = prop.description ? `${key} <small>(${prop.description})</small>` : key;
                    const reqBadge = isRequired ? '<span style="color:var(--del-color)">*</span>' : '';

                    html += `
                        <div>
                            <label for="env_${key}" style="margin-bottom:0;">${label} ${reqBadge}</label>
                            <input type="text" id="env_${key}" name="env_${key}" placeholder="${prop.type || ''}" oninput="updateEnvJSON('${key}', this.value)" style="margin-bottom:0.5rem;">
                        </div>
                    `;
                }
                html += '</div><hr>';
                envContainer.innerHTML = html;
            }

            // Default install config template
            const defaultConfig = {
                command: "npx",
                args: ["-y", serverID],
                env: {}
            };

            document.getElementById('editConfigJSON').value = JSON.stringify(defaultConfig, null, 2);
            document.getElementById('editModal').setAttribute('open', 'true');
        }

        function updateEnvJSON(key, value) {
            try {
                const jsonStr = document.getElementById('editConfigJSON').value;
                const config = JSON.parse(jsonStr);
                if (!config.env) config.env = {};

                if (value) {
                    config.env[key] = value;
                } else {
                    delete config.env[key];
                }

                document.getElementById('editConfigJSON').value = JSON.stringify(config, null, 2);
            } catch(e) {
                // Ignore parsing errors while typing
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').removeAttribute('open');
        }

        async function saveServerConfig() {
            const serverID = document.getElementById('editServerID').value;
            const mode = document.getElementById('editMode').value;
            const jsonStr = document.getElementById('editConfigJSON').value;
            let configObj;

            try {
                configObj = JSON.parse(jsonStr);
            } catch (e) {
                alert("Invalid JSON: " + e);
                return;
            }

            try {
                let url = '/api/server/update';
                let body = {
                    serverId: serverID,
                    config: configObj
                };

                if (mode === 'install') {
                    url = '/api/install';
                    // install endpoint expects {serverId, config} structure now too
                }

                const res = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                if (res.ok) {
                    closeEditModal();
                    alert(mode === 'install' ? "Server installed!" : "Configuration saved!");
                     // Refresh list
                    if (mode === 'install') {
                        switchTab('dashboard');
                    }
                } else {
                    const err = await res.text();
                    alert("Failed: " + err);
                }
            } catch (e) {
                alert("Error: " + e);
            }
        }

        async function deleteServer(serverID) {
            if (!confirm(`Are you sure you want to delete server '${serverID}'? This cannot be undone.`)) {
                return;
            }

            try {
                const res = await fetch('/api/server/remove', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({serverId: serverID})
                });

                if (res.ok) {
                    // alert("Server removed!"); // Optional feedback
                     // Refresh list
                } else {
                    const err = await res.text();
                    alert("Failed to delete: " + err);
                }
            } catch (e) {
                alert("Error deleting server: " + e);
            }
        }

        async function inspectServer(serverID) {
            const server = configData.mcpServers[serverID];
            if (!server) return;

            try {
                const res = await fetch('/api/server/inspect', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({serverId: serverID, config: server})
                });

                const data = await res.json();
                if (data.status === 'success') {
                    prompt(data.message, data.command);
                } else {
                    alert("Failed to get inspection command.");
                }
            } catch (e) {
                alert("Error: " + e);
            }
        }

        async function testServer(serverID) {
            const server = configData.mcpServers[serverID];
            if (!server) return;

            const btn = document.getElementById(`test-btn-${serverID}`);
            const originalText = btn.innerText;
            btn.setAttribute('aria-busy', 'true');
            btn.innerText = "Testing...";

            try {
                const res = await fetch('/api/server/test', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({config: server})
                });

                const result = await res.json();
                if (result.success) {
                    showToast(`‚úÖ Connected! Latency: ${result.latency/1000000}ms. Version: ${result.version || 'Unknown'}`, 'success');
                } else {
                    showToast(`‚ùå Failed: ${result.message}`, 'error');
                }
            } catch (e) {
                showToast("Error: " + e, 'error');
            } finally {
                btn.removeAttribute('aria-busy');
                btn.innerText = originalText;
            }
        }

        async function applyConfig() {
            const btn = document.getElementById('applyBtn');
            const resultArea = document.getElementById('resultArea');
            btn.setAttribute('aria-busy', 'true');
            resultArea.innerHTML = '';

            const selected = [];
            document.querySelectorAll('input[name="client"]:checked').forEach(el => {
                selected.push(el.value);
            });

            if (selected.length === 0) {
                alert("Please select at least one client.");
                btn.setAttribute('aria-busy', 'false');
                return;
            }

            try {
                const res = await fetch('/api/apply', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({clients: selected})
                });
                const data = await res.json();

                let html = '<h4>Results</h4><ul>';
                for (const res of data.results) {
                    if (res.success) {
                        html += `<li class="success">‚úÖ ${res.clientName}: Success (Backup: ${res.backupPath})</li>`;
                    } else {
                        html += `<li class="error">‚ùå ${res.clientName}: Failed - ${res.error}</li>`;
                    }
                }
                html += '</ul>';
                resultArea.innerHTML = html;
                 // Refresh lists

            } catch (e) {
                resultArea.innerHTML = `<span class="error">Request failed: ${e}</span>`;
            } finally {
                btn.setAttribute('aria-busy', 'false');
            }
        }

        async function searchServers() {
            const query = document.getElementById('searchInput').value;
            const btn = document.getElementById('searchBtn');
            const resultArea = document.getElementById('searchResults');

            btn.setAttribute('aria-busy', 'true');
            resultArea.innerHTML = 'Searching...';

            try {
                const res = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
                const servers = await res.json();
                searchResultsData = servers; // Store for install modal

                if (!servers || servers.length === 0) {
                    resultArea.innerHTML = 'No servers found.';
                    return;
                }

                let html = '<table><thead><tr><th>Name</th><th>Details</th><th>Action</th></tr></thead><tbody>';
                for (const s of servers) {
                    let tags = '';
                    if (s.Attributes && s.Attributes.length > 0) {
                        tags = s.Attributes.map(t => `<small style="background:var(--secondary); color:var(--secondary-inverse); padding:2px 6px; border-radius:4px; margin-right:4px;">${t}</small>`).join('');
                    }
                    let toolsBadge = s.Tools > 0 ? `<small style="background:var(--primary); color:var(--primary-inverse); padding:2px 6px; border-radius:4px; margin-right:4px;">üõ†Ô∏è ${s.Tools}</small>` : '';

                    html += `
                        <tr>
                            <td><strong>${s.Name}</strong><br>${toolsBadge}</td>
                            <td>
                                <p style="margin-bottom:0.5rem;">${s.Description}</p>
                                <div>${tags}</div>
                            </td>
                            <td>
                                <button onclick="openInstallModal('${s.Name}')" class="secondary outline">Install</button>
                                ${s.RepositoryURL ? `<a href="${s.RepositoryURL}" target="_blank" role="button" class="outline">View Repo</a>` : ''}
                            </td>
                        </tr>
                    `;
                }
                html += '</tbody></table>';
                resultArea.innerHTML = html;

            } catch (e) {
                resultArea.innerHTML = `<span class="error">Search failed: ${e}</span>`;
            } finally {
                btn.setAttribute('aria-busy', 'false');
            }
        }

        // Initial Load

         // Load health status

        async function deleteBackup(clientName, fileName) {
            if (!confirm(`Delete backup '${fileName}' for ${clientName}?`)) return;
            try {
                const res = await fetch('/api/restore', { // using restore endpoint with DELETE method
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({client: clientName, file: fileName})
                });
                const data = await res.json();
                if (res.ok) {
                    showToast(data.message, 'success');
                    loadBackups();
                } else {
                    showToast("Failed: " + data.message, 'error');
                }
            } catch (e) { showToast("Error: " + e, 'error'); }
        }

        async function restoreBackup(clientName, fileName) {
            if (!confirm(`Are you sure you want to restore '${fileName}' for ${clientName}? Current configuration will be overwritten.`)) {
                return;
            }

            try {
                const res = await fetch('/api/restore', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({client: clientName, file: fileName})
                });

                const data = await res.json();
                if (res.ok) {
                    showToast(data.message, 'success');
                } else {
                    showToast("Failed: " + data.message, 'error');
                }
            } catch (e) {
                showToast("Error: " + e, 'error');
            }
        }

        function openImportModal() {
            document.getElementById('importModal').setAttribute('open', 'true');
        }

        function closeImportModal() {
            document.getElementById('importModal').removeAttribute('open');
            document.getElementById('importJSON').value = '';
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('importJSON').value = text;
                showToast("Pasted from clipboard!", 'success');
            } catch (err) {
                showToast("Failed to read clipboard: " + err, 'error');
            }
        }

        async function importConfig() {
            const config = document.getElementById('importJSON').value;
            if (!config) {
                // simple alert or toast
                alert("Please paste a configuration.");
                return;
            }
            try {
                const res = await fetch('/api/import', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({config: config})
                });

                // check if response is ok
                if (res.ok) {
                    const data = await res.json();
                    alert(data.message);
                    closeImportModal();
                    loadData();
                } else {
                    const txt = await res.text(); // might not be json
                    alert("Import failed: " + txt);
                }
            } catch (e) {
                alert("Error: " + e);
            }
        }

        // --- Custom Clients ---
        async function loadCustomClients() {
            try {
                const [customRes, knownRes] = await Promise.all([
                    fetch('/api/clients/custom'),
                    fetch('/api/clients/known')
                ]);
                const customClients = await customRes.json();
                const knownClients = await knownRes.json();

                renderCustomClients(customClients);
                renderKnownClients(knownClients);
            } catch (e) {
                console.error("Failed to load clients", e);
            }
        }

        function renderKnownClients(clients) {
            const list = document.getElementById('knownClientsList');
            if (!list) return; // Should exist

            if (!clients || clients.length === 0) {
                list.innerHTML = "<p>No known clients loaded.</p>";
                return;
            }

            let html = '<table><thead><tr><th>Name</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
            clients.forEach(c => {
                const isConfigured = configData.clients && configData.clients[c.ID];
                const statusBadge = isConfigured
                    ? `<span style="color:var(--ins-color)">‚úÖ Detected</span>`
                    : `<span style="color:var(--del-color)">‚ùå Not Detected</span>`;

                let actionBtn = '';
                if (!isConfigured) {
                    actionBtn = `<button class="secondary outline small" onclick="configureClient('${c.ID}', '${c.Name}', '${c.ConfigFormat}', '${c.ConfigKey || ''}')">Configure</button>`;
                } else {
                    actionBtn = `<small class="secondary">Managed</small>`;
                }

                html += `
                    <tr>
                        <td><strong>${c.Name}</strong> <small>(${c.ID})</small></td>
                        <td>${statusBadge}</td>
                        <td>${actionBtn}</td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
            list.innerHTML = html;
        }

        function configureClient(id, name, format, key) {
            document.getElementById('newClientID').value = id;
            document.getElementById('newClientName').value = name;
            document.getElementById('newClientFormat').value = format;
            document.getElementById('newClientConfigKey').value = key;
            document.getElementById('newClientPath').focus();
            showToast(`Configuring ${name}. Please verify the path.`, 'info');
        }

        function renderCustomClients(clients) {
            const list = document.getElementById('customClientsList');
            if (!clients || clients.length === 0) {
                list.innerHTML = "<p>No custom clients defined.</p>";
                return;
            }

            let html = '<table><thead><tr><th>ID</th><th>Name</th><th>Path</th><th>Actions</th></tr></thead><tbody>';
            clients.forEach(c => {
                // Get path for current OS
                let path = "Unknown";
                // simple check for structure
                if (c.Paths) {
                    // We don't know OS in JS easily, but backend sends full struct.
                    // Just show ID/Name for now or try to find a path
                    // Actually, let's just list them.
                    const paths = Object.values(c.Paths).flat();
                    if (paths.length > 0) path = paths[0].Path;
                }

                html += `
                    <tr>
                        <td>${c.ID}</td>
                        <td>${c.Name}</td>
                        <td>${path}</td>
                        <td>
                            <button class="outline error small" onclick="deleteCustomClient('${c.ID}')" title="Remove this custom client definition">Delete</button>
                        </td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
            list.innerHTML = html;
        }

        async function addCustomClient() {
            const id = document.getElementById('newClientID').value;
            const name = document.getElementById('newClientName').value;
            const format = document.getElementById('newClientFormat').value;
            const configKey = document.getElementById('newClientConfigKey').value;
            const base = document.getElementById('newClientBase').value;
            const path = document.getElementById('newClientPath').value;

            if (!id || !name || !path) {
                alert("ID, Name, and Path are required.");
                return;
            }

            try {
                const res = await fetch('/api/clients/custom', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        id: id,
                        name: name,
                        configFormat: format,
                        configKey: configKey,
                        baseDir: base,
                        path: path
                    })
                });

                if (res.ok) {
                    alert("Client added!");
                    loadCustomClients();
                    loadData(); // Refresh detected clients
                    // Clear form
                    document.getElementById('newClientID').value = '';
                    document.getElementById('newClientName').value = '';
                    document.getElementById('newClientPath').value = '';
                } else {
                    const txt = await res.text();
                    alert("Failed: " + txt);
                }
            } catch (e) {
                alert("Error: " + e);
            }
        }

        async function deleteCustomClient(id) {
            if (!confirm(`Delete custom client '${id}'?`)) return;
            try {
                const res = await fetch('/api/clients/custom', {
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({id: id})
                });
                if (res.ok) {
                    loadCustomClients();
                    loadData();
                } else {
                    alert("Failed: " + await res.text());
                }
            } catch(e) {
                alert("Error: " + e);
            }
        }

        // --- Inspect Config ---
        async function inspectClientConfig(clientID) {
            const modal = document.getElementById('inspectClientModal');
            const content = document.getElementById('inspectClientContent');
            const title = document.getElementById('inspectClientTitle');

            title.innerText = `Config: ${clientID}`;
            content.innerText = "Loading...";
            modal.setAttribute('open', 'true');

            try {
                const res = await fetch(`/api/client/config?id=${clientID}`);
                if (res.ok) {
                    const text = await res.text();
                    content.innerText = text;
                } else {
                    content.innerText = "Error loading config: " + await res.text();
                }
            } catch (e) {
                content.innerText = "Error: " + e;
            }
        }

        function closeInspectClientModal() {
            document.getElementById('inspectClientModal').removeAttribute('open');
        }

        // --- Backups & Logs ---
        async function loadBackups() {
            try {
                const res = await fetch('/api/backups');
                const backupsMap = await res.json();
                const list = document.getElementById('backupsList');

                if (!backupsMap || Object.keys(backupsMap).length === 0) {
                    list.innerHTML = "No backups found.";
                    return;
                }

                let allBackups = [];
                for (const [clientName, files] of Object.entries(backupsMap)) {
                    if (Array.isArray(files)) {
                        files.forEach(f => {
                             allBackups.push({
                                 ClientName: clientName,
                                 Timestamp: f.timestamp,
                                 Filename: f.name
                             });
                        });
                    }
                }

                if (allBackups.length === 0) {
                    list.innerHTML = "No backups found.";
                    return;
                }

                let html = '<table><thead><tr><th>Client</th><th>Time</th><th>File</th><th>Action</th></tr></thead><tbody>';
                // Sort by time desc
                allBackups.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));

                allBackups.forEach(b => {
                    html += `
                        <tr>
                            <td>${b.ClientName}</td>
                            <td>${new Date(b.Timestamp).toLocaleString()}</td>
                            <td><small>${b.Filename}</small></td>
                            <td>
                                <button class="outline small" onclick="restoreBackup('${b.ClientName}', '${b.Filename}')" title="Restore this configuration state">Restore</button>
                                <button class="outline small error" onclick="deleteBackup('${b.ClientName}', '${b.Filename}')" title="Permanently delete this backup file">Delete</button>
                            </td>
                        </tr>
                    `;
                });
                html += '</tbody></table>';
                list.innerHTML = html;
            } catch (e) {
                console.error(e);
                list.innerHTML = `<span class="error">Error loading backups: ${e}</span>`;
            }
        }


        let allLogs = [];
        async function clearLogs() {
            if (!confirm("Clear all application logs?")) return;
            try {
                await fetch('/api/logs', { method: 'DELETE' });
                loadLogs();
            } catch(e) { console.error(e); }
        }

        function filterLogs() {
            const query = document.getElementById('logFilter').value.toLowerCase();
            const container = document.getElementById('logsContainer');
            if (!query) {
                container.innerText = allLogs.map(l => `[${l.level}] ${l.message}`).join('\n');
                return;
            }
            const filtered = allLogs.filter(l =>
                l.message.toLowerCase().includes(query) || l.level.toLowerCase().includes(query)
            );
            container.innerText = filtered.map(l => `[${l.level}] ${l.message}`).join('\n');
        }

        async function loadLogs() {
            const container = document.getElementById('logsContainer');
            try {
                const res = await fetch('/api/logs');
                const logs = await res.json();
                allLogs = logs;
                filterLogs(); // Display with current filter
                container.scrollTop = container.scrollHeight;
            } catch (e) {
                container.innerText = "Failed to load logs: " + e;
            }
        }

        // --- Toast Notification ---
        function showToast(message, type = 'info') {
             // Simple alert for now, or implement a real toast if CSS allows
             // The previous agent implemented showToast, let's see if it's in extra_js
             // If not, we define a basic one.
             const toast = document.createElement('div');
             toast.style.position = 'fixed';
             toast.style.bottom = '20px';
             toast.style.right = '20px';
             toast.style.padding = '1rem';
             toast.style.borderRadius = '4px';
             toast.style.color = '#fff';
             toast.style.zIndex = '1000';

             if (type === 'success') toast.style.backgroundColor = 'var(--ins-color)';
             else if (type === 'error') toast.style.backgroundColor = 'var(--del-color)';
             else toast.style.backgroundColor = 'var(--primary)';

             toast.innerText = message;
             document.body.appendChild(toast);
             setTimeout(() => {
                 toast.remove();
             }, 3000);
        }



        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            if (tabId === 'backups') loadBackups();
            if (tabId === 'logs') loadLogs();
            if (tabId === 'clients') loadCustomClients();
            if (tabId === 'system') loadSystemInfo();
            if (tabId === 'settings') loadSettings();
            if (tabId === 'sync') loadSyncStatus();
        }



        async function loadSystemInfo() {
            try {
                const res = await fetch('/api/system');
                const data = await res.json();

                document.getElementById('sysAppVersion').innerText = data.appVersion;
                document.getElementById('sysGoVersion').innerText = data.goVersion;
                document.getElementById('sysOS').innerText = `${data.os}/${data.arch}`;
                document.getElementById('sysStructure').innerText = data.projectStructure.trim();

                const subDiv = document.getElementById('sysSubmodules');
                if (data.submodules && data.submodules.length > 0) {
                    let html = '<ul>';
                    data.submodules.forEach(s => html += `<li>${s}</li>`);
                    html += '</ul>';
                    subDiv.innerHTML = html;
                } else {
                    subDiv.innerText = "No submodules active.";
                }
            } catch (e) {
                console.error("Failed to load system info", e);
            }
        }

        async function loadSettings() {
            try {
                const res = await fetch('/api/settings');
                const data = await res.json();
                document.getElementById('settingBackupPath').value = data.backupPath;
                document.getElementById('settingBackupRetention').value = data.backupRetention;

                // Load global env
                const container = document.getElementById('globalEnvContainer');
                container.innerHTML = '';
                if (data.globalEnv && Object.keys(data.globalEnv).length > 0) {
                    for (const [key, value] of Object.entries(data.globalEnv)) {
                        addGlobalEnvField(key, value);
                    }
                } else {
                    addGlobalEnvField(); // Add one empty row
                }
            } catch(e) {
                showToast("Failed to load settings: " + e, 'error');
            }
        }

        function addGlobalEnvField(key = '', value = '') {
            const container = document.getElementById('globalEnvContainer');
            const div = document.createElement('div');
            div.className = 'grid';
            div.style.marginBottom = '0.5rem';
            div.innerHTML = `
                <input type="text" placeholder="Key" class="env-key" value="${key}">
                <input type="text" placeholder="Value" class="env-value" value="${value}">
                <button class="outline error" style="width:auto; padding:0 1rem;" onclick="this.parentElement.remove()">X</button>
            `;
            container.appendChild(div);
        }

        async function saveSettings() {
            const path = document.getElementById('settingBackupPath').value;
            const retention = parseInt(document.getElementById('settingBackupRetention').value);

            if (!path || isNaN(retention) || retention < 1) {
                alert("Invalid input");
                return;
            }

            // Collect env vars
            const globalEnv = {};
            document.querySelectorAll('#globalEnvContainer .grid').forEach(row => {
                const key = row.querySelector('.env-key').value.trim();
                const value = row.querySelector('.env-value').value.trim();
                if (key) {
                    globalEnv[key] = value;
                }
            });

            try {
                const res = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        backupPath: path,
                        backupRetention: retention,
                        globalEnv: globalEnv
                    })
                });

                if (res.ok) {
                    showToast("Settings saved!", 'success');
                } else {
                    showToast("Failed to save: " + await res.text(), 'error');
                }
            } catch(e) {
                showToast("Error: " + e, 'error');
            }
        }

        async function loadSyncStatus() {
            try {
                const res = await fetch('/api/sync/status');
                const data = await res.json();

                if (data.linked) {
                    document.getElementById('syncUnlinked').style.display = 'none';
                    document.getElementById('syncLinked').style.display = 'block';
                    document.getElementById('syncGistID').innerText = data.gistId || "Not created yet";
                    document.getElementById('syncLastTime').innerText = data.lastSynced ? new Date(data.lastSynced).toLocaleString() : "Never";
                } else {
                    document.getElementById('syncUnlinked').style.display = 'block';
                    document.getElementById('syncLinked').style.display = 'none';
                }
            } catch(e) {
                console.error("Sync status check failed", e);
            }
        }

        async function setupSync() {
            const token = document.getElementById('githubToken').value;
            if (!token) {
                alert("Token required");
                return;
            }

            try {
                const res = await fetch('/api/sync/setup', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({token: token})
                });
                if (res.ok) {
                    showToast("Linked successfully!", 'success');
                    loadSyncStatus();
                } else {
                    alert("Failed: " + await res.text());
                }
            } catch(e) { alert("Error: " + e); }
        }

        async function syncPush() {
            if(!confirm("Overwrite Cloud config with Local config?")) return;
            try {
                showToast("Pushing to Gist...", 'info');
                const res = await fetch('/api/sync/push', { method: 'POST' });
                if (res.ok) {
                    showToast("Push successful!", 'success');
                    loadSyncStatus();
                } else {
                    showToast("Push failed: " + await res.text(), 'error');
                }
            } catch(e) { showToast("Error: " + e, 'error'); }
        }

        async function syncPull() {
            if(!confirm("Overwrite Local config with Cloud config? This will restart the app.")) return;
            try {
                showToast("Pulling from Gist...", 'info');
                const res = await fetch('/api/sync/pull', { method: 'POST' });
                if (res.ok) {
                    showToast("Pull successful! Reloading...", 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showToast("Pull failed: " + await res.text(), 'error');
                }
            } catch(e) { showToast("Error: " + e, 'error'); }
        }

        function renderClients() {
            const list = document.getElementById('clientsList');
            if (!configData.clients || Object.keys(configData.clients).length === 0) {
                list.innerHTML = "No clients detected.";
                return;
            }

            let html = '';
            for (const [name, client] of Object.entries(configData.clients)) {
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; border-bottom: 1px solid var(--muted-border-color); padding-bottom: 0.25rem;">
                        <label style="margin-bottom: 0; flex-grow: 1;">
                            <input type="checkbox" name="client" value="${name}" checked>
                            <strong>${name}</strong> <small>(${client.config_path})</small>
                        </label>
                        <button class="outline secondary small" style="width: auto; padding: 0.2rem 0.5rem;" onclick="inspectClientConfig('${name}')" title="View Config File">üëÅÔ∏è</button>
                    </div>
                `;
            }
            list.innerHTML = html;
        }

loadData();
checkDoctor();
setInterval(loadLogs, 5000);

        async function checkDoctor() {
            try {
                const res = await fetch('/api/doctor');
                const results = await res.json();

                const container = document.getElementById('systemDoctorReport');
                if (!container) return; // fail safe

                let html = '<ul style="margin:0; padding-left:1rem;">';
                results.forEach(r => {
                    let icon = '‚úÖ';
                    let color = 'var(--ins-color)';
                    if (r.status === 'error') { icon = '‚ùå'; color = 'var(--del-color)'; }
                    else if (r.status === 'warning') { icon = '‚ö†Ô∏è'; color = 'var(--pico-color-amber-500)'; }

                    html += `<li style="color:${color}; list-style:none;">${icon} <strong>${r.name}</strong>: ${r.message}</li>`;
                });
                html += '</ul>';
                container.innerHTML = html;

            } catch (e) {
                console.error("Doctor check failed", e);
            }
        }

</script>

    <!-- Import Modal -->
    <dialog id="importModal">
        <article>
            <header>
                <a href="#close" aria-label="Close" class="close" onclick="closeImportModal()"></a>
                Import Configuration
            </header>
            <p>Paste an existing <code>mcpServers</code> JSON configuration below:</p>
            <textarea id="importJSON" rows="10" placeholder='{"mcpServers": { ... }}'></textarea>
            <footer>
                <button class="secondary outline" onclick="pasteFromClipboard()">üìã Paste from Clipboard</button>
                <button onclick="importConfig()">Import</button>
            </footer>
        </article>
    </dialog>

    <!-- Inspect Client Modal -->
    <dialog id="inspectClientModal">
        <article style="width: 80%; max-width: 1000px;">
            <header>
                <a href="#close" aria-label="Close" class="close" onclick="closeInspectClientModal()"></a>
                <span id="inspectClientTitle">Client Configuration</span>
            </header>
            <pre id="inspectClientContent" style="max-height: 600px; overflow: auto; background: #f4f4f4; padding: 1rem; font-family: monospace; font-size: 0.9rem; border-radius: 4px;"></pre>
        </article>
    </dialog>

    <dialog id="editRegistryModal">
        <article>
            <header>
                <a href="#close" aria-label="Close" class="close" onclick="closeEditRegistryModal()"></a>
                Edit Registry
            </header>
            <label>Name</label>
            <input type="text" id="editRegName" readonly>
            <label>URL</label>
            <input type="url" id="editRegUrl">
            <footer>
                <button class="secondary outline" onclick="closeEditRegistryModal()">Cancel</button>
                <button onclick="saveRegistryUpdate()">Save</button>
            </footer>
        </article>
    </dialog>

</body>
</html>
